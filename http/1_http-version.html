<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>协议版本 | Alphawq&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/_blog/assets/logo.png">
    <meta name="description" content="変わっていけるのは 自分自身だけ それだけさ">
    
    <link rel="preload" href="/_blog/assets/css/0.styles.6fa05f6e.css" as="style"><link rel="preload" href="/_blog/assets/js/app.5d3f5ce3.js" as="script"><link rel="preload" href="/_blog/assets/js/3.59e939e7.js" as="script"><link rel="preload" href="/_blog/assets/js/1.da93e4f7.js" as="script"><link rel="preload" href="/_blog/assets/js/38.91d9c466.js" as="script"><link rel="preload" href="/_blog/assets/js/8.e158b772.js" as="script"><link rel="prefetch" href="/_blog/assets/js/10.60195a69.js"><link rel="prefetch" href="/_blog/assets/js/11.cb52f98d.js"><link rel="prefetch" href="/_blog/assets/js/12.067772bc.js"><link rel="prefetch" href="/_blog/assets/js/13.9ab6ac0a.js"><link rel="prefetch" href="/_blog/assets/js/14.01c5a9da.js"><link rel="prefetch" href="/_blog/assets/js/15.90b48b9f.js"><link rel="prefetch" href="/_blog/assets/js/16.aa5b2830.js"><link rel="prefetch" href="/_blog/assets/js/17.cc6a2a06.js"><link rel="prefetch" href="/_blog/assets/js/18.dc2bb1f4.js"><link rel="prefetch" href="/_blog/assets/js/19.479896be.js"><link rel="prefetch" href="/_blog/assets/js/20.b3ad8d8c.js"><link rel="prefetch" href="/_blog/assets/js/21.6ea0ebc5.js"><link rel="prefetch" href="/_blog/assets/js/22.9739e997.js"><link rel="prefetch" href="/_blog/assets/js/23.81366069.js"><link rel="prefetch" href="/_blog/assets/js/24.cbb8eb1f.js"><link rel="prefetch" href="/_blog/assets/js/25.0d02e21a.js"><link rel="prefetch" href="/_blog/assets/js/26.e4de969e.js"><link rel="prefetch" href="/_blog/assets/js/27.c298bb11.js"><link rel="prefetch" href="/_blog/assets/js/28.399c0b46.js"><link rel="prefetch" href="/_blog/assets/js/29.5b08c62e.js"><link rel="prefetch" href="/_blog/assets/js/30.1459cebc.js"><link rel="prefetch" href="/_blog/assets/js/31.c22c8d51.js"><link rel="prefetch" href="/_blog/assets/js/32.02ce7b0f.js"><link rel="prefetch" href="/_blog/assets/js/33.b80570d3.js"><link rel="prefetch" href="/_blog/assets/js/34.1136c326.js"><link rel="prefetch" href="/_blog/assets/js/35.c75b822a.js"><link rel="prefetch" href="/_blog/assets/js/36.cb766a0a.js"><link rel="prefetch" href="/_blog/assets/js/37.fc5ef1b7.js"><link rel="prefetch" href="/_blog/assets/js/39.5d352bc5.js"><link rel="prefetch" href="/_blog/assets/js/4.4f7de8c6.js"><link rel="prefetch" href="/_blog/assets/js/40.27fea55b.js"><link rel="prefetch" href="/_blog/assets/js/41.8e28a800.js"><link rel="prefetch" href="/_blog/assets/js/42.19660476.js"><link rel="prefetch" href="/_blog/assets/js/43.6998c061.js"><link rel="prefetch" href="/_blog/assets/js/44.b6b12799.js"><link rel="prefetch" href="/_blog/assets/js/45.85c3bc8c.js"><link rel="prefetch" href="/_blog/assets/js/46.443820db.js"><link rel="prefetch" href="/_blog/assets/js/47.260dfa87.js"><link rel="prefetch" href="/_blog/assets/js/48.b3d63806.js"><link rel="prefetch" href="/_blog/assets/js/49.df02f2b9.js"><link rel="prefetch" href="/_blog/assets/js/5.a8fcc4d8.js"><link rel="prefetch" href="/_blog/assets/js/50.1032a6af.js"><link rel="prefetch" href="/_blog/assets/js/51.542c0a72.js"><link rel="prefetch" href="/_blog/assets/js/52.15db304e.js"><link rel="prefetch" href="/_blog/assets/js/53.ab7b99d8.js"><link rel="prefetch" href="/_blog/assets/js/54.052563d8.js"><link rel="prefetch" href="/_blog/assets/js/55.8feaccb6.js"><link rel="prefetch" href="/_blog/assets/js/56.d24aadcc.js"><link rel="prefetch" href="/_blog/assets/js/57.37f29093.js"><link rel="prefetch" href="/_blog/assets/js/58.4ca6ded8.js"><link rel="prefetch" href="/_blog/assets/js/59.f7380109.js"><link rel="prefetch" href="/_blog/assets/js/6.0aae7563.js"><link rel="prefetch" href="/_blog/assets/js/60.48e9beb2.js"><link rel="prefetch" href="/_blog/assets/js/61.ffc90215.js"><link rel="prefetch" href="/_blog/assets/js/62.cfc05217.js"><link rel="prefetch" href="/_blog/assets/js/63.0bd10e46.js"><link rel="prefetch" href="/_blog/assets/js/64.8d5b085c.js"><link rel="prefetch" href="/_blog/assets/js/65.1abc8c02.js"><link rel="prefetch" href="/_blog/assets/js/66.88839bed.js"><link rel="prefetch" href="/_blog/assets/js/67.61f0c1ac.js"><link rel="prefetch" href="/_blog/assets/js/68.ef8c9a1f.js"><link rel="prefetch" href="/_blog/assets/js/69.07f8885c.js"><link rel="prefetch" href="/_blog/assets/js/7.fea74fc8.js"><link rel="prefetch" href="/_blog/assets/js/70.3f8b10c4.js"><link rel="prefetch" href="/_blog/assets/js/71.94350053.js"><link rel="prefetch" href="/_blog/assets/js/9.0251eab4.js">
    <link rel="stylesheet" href="/_blog/assets/css/0.styles.6fa05f6e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-1156296a><div data-v-1156296a><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-1156296a data-v-1156296a><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-4e82dffc data-v-1156296a data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>Alphawq's Blog</h3> <p class="description" data-v-4e82dffc data-v-4e82dffc>変わっていけるのは 自分自身だけ それだけさ</p> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>Alphawq</span>
            
          <!---->
          2024
        </a></span></div></div> <div class="hide" data-v-1156296a><header class="navbar" data-v-1156296a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/_blog/" class="home-link router-link-active"><!----> <span class="site-name">Alphawq's Blog</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/_blog/" class="nav-link"><i class="undefined"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/_blog/categories/Algorithm/" class="nav-link"><i class="undefined"></i>
  Algorithm
</a></li><li class="dropdown-item"><!----> <a href="/_blog/categories/ECMAScript/" class="nav-link"><i class="undefined"></i>
  ECMAScript
</a></li><li class="dropdown-item"><!----> <a href="/_blog/categories/Interview/" class="nav-link"><i class="undefined"></i>
  Interview
</a></li><li class="dropdown-item"><!----> <a href="/_blog/categories/GitHub/" class="nav-link"><i class="undefined"></i>
  GitHub
</a></li><li class="dropdown-item"><!----> <a href="/_blog/categories/HTTP/" class="nav-link"><i class="undefined"></i>
  HTTP
</a></li><li class="dropdown-item"><!----> <a href="/_blog/categories/React/" class="nav-link"><i class="undefined"></i>
  React
</a></li><li class="dropdown-item"><!----> <a href="/_blog/categories/Profile/" class="nav-link"><i class="undefined"></i>
  Profile
</a></li><li class="dropdown-item"><!----> <a href="/_blog/categories/TCP/" class="nav-link"><i class="undefined"></i>
  TCP
</a></li><li class="dropdown-item"><!----> <a href="/_blog/categories/vscode/" class="nav-link"><i class="undefined"></i>
  vscode
</a></li><li class="dropdown-item"><!----> <a href="/_blog/categories/Vue/" class="nav-link"><i class="undefined"></i>
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/_blog/categories/Vue3/" class="nav-link"><i class="undefined"></i>
  Vue3
</a></li><li class="dropdown-item"><!----> <a href="/_blog/categories/Vuepress/" class="nav-link"><i class="undefined"></i>
  Vuepress
</a></li></ul></div></div><div class="nav-item"><a href="/_blog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/_blog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div> <a href="https://github.com/alphawq/_blog.git" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-github"></i>
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask" data-v-1156296a></div> <aside class="sidebar" data-v-1156296a><div class="personal-info-wrapper" data-v-828910c6 data-v-1156296a><img src="/_blog/assets/avatar.png" alt="author-avatar" class="personal-img" data-v-828910c6> <h3 class="name" data-v-828910c6>
    Alphawq
  </h3> <div class="num" data-v-828910c6><div data-v-828910c6><h3 data-v-828910c6>60</h3> <h6 data-v-828910c6>Articles</h6></div> <div data-v-828910c6><h3 data-v-828910c6>30</h3> <h6 data-v-828910c6>Tags</h6></div></div> <ul class="social-links" data-v-828910c6></ul> <hr data-v-828910c6></div> <nav class="nav-links"><div class="nav-item"><a href="/_blog/" class="nav-link"><i class="undefined"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/_blog/categories/Algorithm/" class="nav-link"><i class="undefined"></i>
  Algorithm
</a></li><li class="dropdown-item"><!----> <a href="/_blog/categories/ECMAScript/" class="nav-link"><i class="undefined"></i>
  ECMAScript
</a></li><li class="dropdown-item"><!----> <a href="/_blog/categories/Interview/" class="nav-link"><i class="undefined"></i>
  Interview
</a></li><li class="dropdown-item"><!----> <a href="/_blog/categories/GitHub/" class="nav-link"><i class="undefined"></i>
  GitHub
</a></li><li class="dropdown-item"><!----> <a href="/_blog/categories/HTTP/" class="nav-link"><i class="undefined"></i>
  HTTP
</a></li><li class="dropdown-item"><!----> <a href="/_blog/categories/React/" class="nav-link"><i class="undefined"></i>
  React
</a></li><li class="dropdown-item"><!----> <a href="/_blog/categories/Profile/" class="nav-link"><i class="undefined"></i>
  Profile
</a></li><li class="dropdown-item"><!----> <a href="/_blog/categories/TCP/" class="nav-link"><i class="undefined"></i>
  TCP
</a></li><li class="dropdown-item"><!----> <a href="/_blog/categories/vscode/" class="nav-link"><i class="undefined"></i>
  vscode
</a></li><li class="dropdown-item"><!----> <a href="/_blog/categories/Vue/" class="nav-link"><i class="undefined"></i>
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/_blog/categories/Vue3/" class="nav-link"><i class="undefined"></i>
  Vue3
</a></li><li class="dropdown-item"><!----> <a href="/_blog/categories/Vuepress/" class="nav-link"><i class="undefined"></i>
  Vuepress
</a></li></ul></div></div><div class="nav-item"><a href="/_blog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/_blog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div> <a href="https://github.com/alphawq/_blog.git" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-github"></i>
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <ul class="sidebar-links"><li><a href="/_blog/http/" aria-current="page" class="sidebar-link">HTTP协议</a></li><li><a href="/_blog/http/1_http-version.html" aria-current="page" class="active sidebar-link">协议版本</a></li><li><a href="/_blog/http/2_http-status.html" class="sidebar-link">常见状态码</a></li><li><a href="/_blog/http/3_http-cache.html" class="sidebar-link">缓存控制</a></li><li><a href="/_blog/http/4_http-cors.html" class="sidebar-link">CORS</a></li><li><a href="/_blog/http/5_http-https.html" class="sidebar-link">HTTPS</a></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-4e82dffc data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>协议版本</h3> <!----> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>Alphawq</span>
            
          <!---->
          2024
        </a></span></div></div> <div data-v-1156296a><main class="page" style="padding-right:0;"><section><div class="page-title"><h1 class="title">协议版本</h1> <div data-v-1ff7123e><i class="iconfont reco-account" data-v-1ff7123e><span data-v-1ff7123e>Alphawq</span></i> <!----> <!----> <i class="tags iconfont reco-tag" data-v-1ff7123e><span class="tag-item" data-v-1ff7123e>HTTP</span></i></div></div> <div class="theme-reco-content content__default"><hr> <p></p><div class="table-of-contents"><ul><li><a href="#http0-9">HTTP0.9</a><ul><li><a href="#问题">问题</a></li></ul></li><li><a href="#http1-0-非标准">HTTP1.0 - 非标准</a><ul><li><a href="#引入头字段">引入头字段</a></li><li><a href="#如何通过头字段来支持多种类型数据的传输">如何通过头字段来支持多种类型数据的传输</a></li><li><a href="#其他特性">其他特性</a></li><li><a href="#存在的问题">存在的问题</a></li></ul></li><li><a href="#http1-1">HTTP1.1</a><ul><li><a href="#connection-keep-alive">Connection: keep-alive</a></li><li><a href="#域名分片">域名分片</a></li><li><a href="#虚拟主机支持-host-头字段">虚拟主机支持 - Host 头字段</a></li><li><a href="#支持响应分块-transfer-encoding-chunked">支持响应分块（Transfer-Encoding: chunked）</a></li><li><a href="#更完善的缓存机制">更完善的缓存机制</a></li></ul></li><li><a href="#http2-0">HTTP2.0</a><ul><li><a href="#重要概念">重要概念</a></li><li><a href="#头部压缩">头部压缩</a></li><li><a href="#服务端推送">服务端推送</a></li><li><a href="#二进制分帧">二进制分帧</a></li><li><a href="#多路复用">多路复用</a></li></ul></li><li><a href="#http3-0">HTTP3.0</a><ul><li><a href="#http2-的缺点">HTTP2 的缺点</a></li><li><a href="#解决方案">解决方案</a></li></ul></li></ul></div><p></p> <hr> <img src="/_blog/assets/http/1.png" alt="" width="400px" height="auto" class="cmp-img-shadow" data-v-b78a8a5a> <h1 id="http0-9"><a href="#http0-9" class="header-anchor">#</a> HTTP0.9</h1> <p>总的来说，当时的需求很简单，就是用来传输体积很小的 HTML 文件，所以 HTTP/0.9 的实现有以下三个特点。</p> <ul><li>第一个是只有一个请求行，并没有 HTTP 请求头和请求体，因为只需要一个请求行就可以完整表达客户端的需求了。</li> <li>第二个是服务器也没有返回头信息，这是因为服务器端并不需要告诉客户端太多信息，只需要返回数据就可以了。</li> <li>第三个是返回的文件内容是<strong>以 ASCII 字符流来传输的</strong>，因为都是 HTML 格式的文件，所以使用 ASCII 字节码来传输是最合适的。</li></ul> <h2 id="问题"><a href="#问题" class="header-anchor">#</a> 问题</h2> <p>万维网的高速发展带来了很多新的需求，而 HTTP/0.9 已经不能适用新兴网络的发展，所以这时就需要一个新的协议来支撑新兴网络，这就是 HTTP/1.0 诞生的原因。不过在详细分析 HTTP/1.0 之前，我们先来分析下新兴网络都带来了哪些新需求。</p> <p>首先在浏览器中展示的不单是 HTML 文件了，还包括了 JavaScript、CSS、图片、音频、视频等不同类型的文件。因此<strong>支持多种类型的文件下载</strong>是 HTTP/1.0 的一个核心诉求
而且文件格式不仅仅局限于 ASCII 编码，还有很多其他类型编码的文件</p> <h1 id="http1-0-非标准"><a href="#http1-0-非标准" class="header-anchor">#</a> HTTP1.0 - 非标准</h1> <h2 id="引入头字段"><a href="#引入头字段" class="header-anchor">#</a> 引入头字段</h2> <p>为了解决 0.9 版本不支持多种类型文件的传输问题，让客户端和服务器能更深入地交流，HTTP/1.0 <strong>引入了请求头和响应头</strong>，它们都是以为 Key-Value 形式保存的，在 HTTP 发送请求时，会带上请求头信息，服务器返回数据时，会先返回响应头信息。</p> <img src="/_blog/assets/http/2.png" alt="" width="400px" height="auto" class="cmp-img-shadow" data-v-b78a8a5a> <h2 id="如何通过头字段来支持多种类型数据的传输"><a href="#如何通过头字段来支持多种类型数据的传输" class="header-anchor">#</a> 如何通过头字段来支持多种类型数据的传输</h2> <p>要支持多种类型的文件，我们就需要解决以下几个问题：</p> <ul><li>首先，浏览器需要知道<strong>服务器返回的数据是什么类型</strong>的，然后浏览器才能根据不同的数据类型做针对性的处理。</li> <li>其次，由于万维网所支持的应用变得越来越广，所以<strong>单个文件的数据量也变得越来越大</strong>。为了提升传输性能，服务器会<strong>对数据进行压缩后再传输</strong>，所以浏览器需要知道服务器压缩的方法。</li> <li>再次，由于万维网是支持全球范围的，所以<strong>需要提供国际化的支持</strong>，服务器需要对不同的地区提供不同的语言版本，这就需要浏览器告诉服务器它想要什么语言版本的页面。</li> <li>最后，由于增加了各种不同类型的文件，而<strong>每种文件的编码形式又可能不一样</strong>，为了能够准确地读取文件，浏览器需要知道<strong>文件的编码类型</strong></li></ul> <p>基于以上问题，HTTP/1.0 的方案是<strong>通过请求头和响应头来进行协商</strong>，在发起请求时候会通过 HTTP 请求头告诉服务器它期待服务器返回<strong>什么类型的文件</strong>、采取<strong>什么形式的压缩</strong>、提供<strong>什么语言</strong>的文件以及<strong>文件的具体编码</strong>。最终发送出来的请求头内容如下：</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code><span class="token header-name keyword">accept:</span> text/html
<span class="token header-name keyword">accept-encoding:</span> gzip, deflate, br
<span class="token header-name keyword">accept-Charset:</span> ISO-8859-1,utf-8
<span class="token header-name keyword">accept-language:</span> zh-CN,zh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="其他特性"><a href="#其他特性" class="header-anchor">#</a> 其他特性</h2> <p>HTTP/1.0 除了对多文件提供良好的支持外，还依据当时实际的需求引入了很多其他的特性，这些特性都是通过请求头和响应头来实现的。下面我们来看看新增的几个典型的特性：</p> <ul><li><strong>状态码</strong>：有的请求服务器可能无法处理，或者处理出错，这时候就需要告诉浏览器服务器最终处理该请求的情况，这就引入了状态码。状态码是通过响应行的方式来通知浏览器的。</li> <li><strong>缓存控制</strong>：为了减轻服务器的压力，在 HTTP/1.0 中提供了 Cache 机制（If-Modified-Since/Expires ），用来缓存已经下载过的数据。</li> <li><strong>ua 信息</strong>：服务器需要统计客户端的基础信息，比如 Windows 和 macOS 的用户数量分别是多少，所以 HTTP/1.0 的请求头中还加入了用户代理（即 ua 信息）的字段</li></ul> <h2 id="存在的问题"><a href="#存在的问题" class="header-anchor">#</a> 存在的问题</h2> <ul><li>队头阻塞问题</li></ul> <p>HTTP/1.0 每进行一次 HTTP 通信，都需要经历建立 TCP 连接、传输 HTTP 数据和断开 TCP 连接三个阶段，值得注意的是，所有的请求任务都被放在一个任务队列中<strong>串行执行</strong>，一旦队首的请求处理太慢，就会阻塞后面请求的处理。这就是著名的 <strong>HTTP 队头阻塞问题</strong>。</p> <h1 id="http1-1"><a href="#http1-1" class="header-anchor">#</a> HTTP1.1</h1> <p>不过随着技术的继续发展，需求也在不断迭代更新，很快 HTTP/1.0 也不能满足需求了，所以 HTTP/1.1 又在 HTTP/1.0 的基础之上做了大量的更新。接下来我们来看看 HTTP/1.0 遇到了哪些主要的问题，以及 HTTP/1.1 又是如何改进的。
为了解决 1.0 版本中提到的队头阻塞问题，1.1 中引入了持久链接：</p> <h2 id="connection-keep-alive"><a href="#connection-keep-alive" class="header-anchor">#</a> Connection: keep-alive</h2> <p>HTTP/1.0 每进行一次 HTTP 通信，都需要经历建立 TCP 连接、传输 HTTP 数据和断开 TCP 连接三个阶段。
为了解决这个问题，HTTP/1.1 中增加了持久连接的方法，它的特点是在一个 TCP 连接上可以传输多个 HTTP 请求，只要浏览器或者服务器没有明确断开连接，那么该 TCP 连接会一直保持。</p> <p><code>keep-alive</code> 也是一个通用标头，一般 Connection 都会和 keep-alive 一起使用，keep-alive 有两个参数，一个是 timeout；另一个是 max，它们的主要表现形式如下</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code><span class="token header-name keyword">Connection:</span> Keep-Alive
<span class="token header-name keyword">Keep-Alive:</span> timeout=5, max=1000
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>timeout: 指的是空闲连接必须打开的最短时间，也就是说这次请求的连接时间不能少于 5 秒</li> <li>max: 指的是在连接关闭之前服务器所能够收到的最大请求数</li></ul> <h3 id="tcp-保活计时器"><a href="#tcp-保活计时器" class="header-anchor">#</a> TCP 保活计时器</h3> <p>防止持久连接一直空闲无法断开</p> <img src="/_blog/assets/http/3.png" alt="" width="400px" height="auto" class="cmp-img-shadow" data-v-b78a8a5a> <p>HTTP 的持久连接可以有效减少 TCP 建立连接和断开连接的次数，减少了服务器额外的负担，持久连接在 HTTP/1.1 中是<strong>默认开启</strong>的，无需手动设置 <code>Connection：Keep-Alive</code>，不想要采用持久连接：<code>Connection: close</code>。</p> <p>目前浏览器中对于同一个域名，默认允许同时建立 6 ~ 8 个 TCP 持久连接，这个数字为什么不能更大呢？实际上这是出于公平性的考虑，每个连接对于服务端来说都会带来一定开销，如果浏览器不加以限制，一个性能好带宽足的终端就可能耗尽服务端所有资源，造成其他人无法使用。</p> <h2 id="域名分片"><a href="#域名分片" class="header-anchor">#</a> 域名分片</h2> <p>其实除了持久连接之外，还有另外一种方式来解决 1.0 中存在的队头阻塞问题，那就是域名分片。</p> <p>虽然一个域名可以同时并发 6~8 个长连接，但如果某个网页的资源非常多，那单个域名下同时也只能有 6-8 个资源在并发请求，所以，还可以通过添加多个域名的方式，将静态资源分配到不同的域名上来增加并发。</p> <h2 id="虚拟主机支持-host-头字段"><a href="#虚拟主机支持-host-头字段" class="header-anchor">#</a> 虚拟主机支持 - Host 头字段</h2> <p>随着虚拟主机技术的发展，需要实现在一台物理主机上绑定多个虚拟主机，每个虚拟主机都有自己的单独的域名，这些单独的域名都公用同一个 IP 地址。因此，HTTP/1.1 的请求头中增加了 Host 字段，用来表示当前的域名地址，这样服务器就可以根据不同的 Host 值做不同的处理。</p> <h2 id="支持响应分块-transfer-encoding-chunked"><a href="#支持响应分块-transfer-encoding-chunked" class="header-anchor">#</a> 支持响应分块（Transfer-Encoding: chunked）</h2> <ul><li>定长内容：<code>Content-Length</code>，一般定长内容的响应会具有<code>Content-Length</code>字段，来指明响应包体的长度。</li> <li>不定长内容：<code>Transfer-Encoding: chunked</code>，表示分块传输数据，设置这个字段后会自动产生两个效果:
<ul><li>Content-Length 字段会被忽略，同时每个块的开头会添加上当前分块的长度</li> <li>基于长连接持续推送动态内容，最后使用一个 0 长度的块作为终止块，表示数据发送完成</li></ul></li></ul> <h2 id="更完善的缓存机制"><a href="#更完善的缓存机制" class="header-anchor">#</a> 更完善的缓存机制</h2> <p>在 HTTP1.0 中主要使用 header 里的 If-Modified-Since,Expires 来做为缓存判断的标准，HTTP1.1 则引入了更多的缓存控制策略例如<code>ETag</code>，<code>If-Unmodified-Since</code>, <code>If-Match</code>, <code>If-None-Match</code> 等更多可供选择的缓存头来控制缓存策略</p> <h1 id="http2-0"><a href="#http2-0" class="header-anchor">#</a> HTTP2.0</h1> <blockquote><p>HTTP/2 是一个<strong>二进制协议</strong>（1.x 使用的是文本传输），其基于“帧”的结构设计</p></blockquote> <h2 id="重要概念"><a href="#重要概念" class="header-anchor">#</a> 重要概念</h2> <ul><li><p>Connection：1 个 TCP 连接，包含 1 个或者多个 stream。所有通信都在一个 TCP 连接上完成，此连接可以承载任意数量的双向数据流。</p></li> <li><p>Stream：一个双向通信的数据流，包含 1 条或者多条 Message。每个数据流都有一个唯一的标识符和可选的优先级信息，用于承载双向消息。</p></li> <li><p>Message：对应 HTTP/1.1 中的请求 request 或者响应 response，包含 1 条或者多条 Frame。</p></li> <li><p>Frame：最小通信单位，以二进制压缩格式存放内容。来自不同数据流的帧可以交错发送，然后再根据每个帧头的数据流标识符重新组装。</p></li></ul> <p>在 HTTP/1.1 中的一个消息是由 Start Line + header + body 组成的，而 HTTP/2 中一个消息是由 HEADER frame + 若干个 DATA frame 组成的，如下图：</p> <img src="/_blog/assets/http/5.svg" alt="" width="400px" height="auto" class="cmp-img-shadow" data-v-b78a8a5a> <p>HTTP/2 当中<strong>废除了起始行</strong>的概念，将起始行中的请求方法、URI、状态码转换成了头字段，不过这些字段都有一个&quot;:&quot;前缀，用来和其它请求头区分开。</p> <img src="/_blog/assets/http/6.svg" alt="" width="400px" height="auto" class="cmp-img-shadow" data-v-b78a8a5a> <h2 id="头部压缩"><a href="#头部压缩" class="header-anchor">#</a> 头部压缩</h2> <p>HTTP 1.1 版本会出现 User-Agent、Cookie、Accept、Server、Range 等字段可能会占用几百甚至几千字节，而 Body 却经常只有几十字节，所以导致头部偏重，HTTP 2.0 使用 <strong>HPACK</strong> 算法进行压缩。</p> <ul><li>在服务器和客户端之间建立哈希表，将用到的字段存放在这张表中，那么在传输的时候对于之前出现过的值，只需要把索引(比如 0，1，2，...)传给对方即可，对方拿到索引查表就行了</li> <li>对于整数和字符串进行哈夫曼编码</li></ul> <h2 id="服务端推送"><a href="#服务端推送" class="header-anchor">#</a> 服务端推送</h2> <p>在 HTTP/2 当中，服务器已经不再是完全被动地接收请求，响应请求，它也能新建 stream 来给客户端发送消息，当 TCP 连接建立之后，比如浏览器请求一个 HTML 文件，服务器就可以在返回 HTML 的基础上，将 HTML 中引用到的其他资源文件一起返回给客户端，减少客户端的等待</p> <h2 id="二进制分帧"><a href="#二进制分帧" class="header-anchor">#</a> 二进制分帧</h2> <p>首先，HTTP/2 认为明文传输对机器而言太麻烦了，不方便计算机的解析，因为对于文本而言会有多义性的字符，比如回车换行到底是内容还是分隔符，在内部需要用到状态机去识别，效率比较低。于是 HTTP/2 干脆把报文全部换成二进制格式，全部传输 01 串，方便了机器的解析。</p> <p>原来 Headers + Body 的报文格式如今被拆分成了一个个二进制的帧，<strong>用 Headers 帧存放头部字段</strong>，<strong>Data 帧存放请求体数据</strong>。分帧之后，服务器看到的不再是一个个完整的 HTTP 请求报文，而是一堆乱序的二进制帧。<strong>这些二进制帧不存在先后关系，因此也就不会排队等待</strong>，也就没有了 HTTP 的队头阻塞问题。</p> <p>通信双方都可以给对方发送二进制帧，这种二进制帧的双向传输的序列，也叫做流(Stream)。HTTP/2 用流来在一个 TCP 连接上来进行多个数据帧的通信，这就是多路复用的概念。</p> <p>可能你会有一个疑问，既然是乱序首发，那最后如何来处理这些乱序的数据帧呢？</p> <p>首先要声明的是，所谓的乱序，指的是<strong>不同 ID 的 Stream 是乱序的</strong>，但<strong>同一个 Stream ID 的帧一定是按顺序传输的</strong>。二进制帧到达后对方会将 Stream ID 相同的二进制帧组装成完整的请求报文和响应报文。</p> <h3 id="帧结构"><a href="#帧结构" class="header-anchor">#</a> 帧结构</h3> <img src="/_blog/assets/http/4.png" alt="" width="400px" height="auto" class="cmp-img-shadow" data-v-b78a8a5a> <ul><li><p>每个帧分为<strong>帧头</strong>和<strong>帧体</strong>。先是三个字节的帧长度，这个长度表示的是帧体的长度。</p></li> <li><p>然后是帧类型，大概可以分为<strong>数据帧</strong>和<strong>控制帧</strong>两种。数据帧用来存放 HTTP 报文，控制帧用来管理流的传输。</p></li> <li><p>接下来的一个字节是帧标志，里面一共有 8 个标志位，常用的有 END_HEADERS 表示头数据结束，END_STREAM 表示单方向数据发送结束。</p></li> <li><p>后 4 个字节是 Stream ID, 也就是流标识符，有了它，接收方就能从乱序的二进制帧中选择出 ID 相同的帧，按顺序组装成请求/响应报文。</p></li></ul> <h2 id="多路复用"><a href="#多路复用" class="header-anchor">#</a> 多路复用</h2> <p>HTTP 1.x 中，如果想并发多个请求，必须使用多个 TCP 链接，且浏览器为了控制资源，还会对单个域名有 6-8 个的 TCP 链接请求限制。</p> <p>HTTP2 中：</p> <ul><li>同域名下所有通信都在单个连接上完成。</li> <li>单个连接可以承载任意数量的双向数据流。</li> <li>数据流以消息的形式发送，而消息又由一个或多个帧组成，多个帧之间可以乱序发送，因为根据帧首部的流标识可以重新组装，也就是 <strong>Stream ID</strong>，流标识符，有了它，接收方就能从乱序的二进制帧中选择 ID 相同的帧，按照顺序组装成请求/响应报文。</li></ul> <h1 id="http3-0"><a href="#http3-0" class="header-anchor">#</a> HTTP3.0</h1> <h2 id="http2-的缺点"><a href="#http2-的缺点" class="header-anchor">#</a> HTTP2 的缺点</h2> <ul><li><p>TCP 以及 TCP+TLS 建立连接的延时，HTTP/2 使用 TCP 协议来传输的，而如果使用 HTTPS 的话，还需要使用 TLS 协议进行安全传输，而使用 TLS 也需要一个握手过程,在传输数据之前，导致我们需要花掉 3 ～ 4 个 RTT。</p></li> <li><p>TCP 的队头阻塞并没有彻底解决。在 HTTP/2 中，多个请求是跑在一个 TCP 管道中的。但<strong>当 HTTP/2 出现丢包时，整个 TCP 都要开始等待重传，那么就会阻塞该 TCP 连接中的所有请求</strong>。</p></li></ul> <h2 id="解决方案"><a href="#解决方案" class="header-anchor">#</a> 解决方案</h2> <p>Google 在推 SPDY 的时候就已经意识到了这些问题，于是就另起炉灶搞了一个<strong>基于 UDP 协议的 QUIC 协议</strong>，让 HTTP 跑在 QUIC 上而不是 TCP 上。主要特性如下：</p> <ul><li>实现了类似 TCP 的流量控制、传输可靠性的功能。虽然 UDP 不提供可靠性的传输，但 QUIC 在 UDP 的基础之上增加了一层来保证数据可靠性传输。它提供了数据包重传、拥塞控制以及其他一些 TCP 中存在的特性</li> <li>实现了快速握手功能。由于 QUIC 是基于 UDP 的，所以 QUIC 可以实现使用 0-RTT 或者 1-RTT 来建立连接，这意味着 QUIC 可以用最快的速度来发送和接收数据。</li> <li>集成了 TLS 加密功能。目前 QUIC 使用的是 TLS1.3，相较于早期版本 TLS1.3 有更多的优点，其中最重要的一点是减少了握手所花费的 RTT 个数。</li> <li>多路复用，彻底解决 TCP 中队头阻塞的问题。</li></ul></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">10/21/2024, 4:15:17 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/_blog/http/" class="prev router-link-active">
            HTTP协议
          </a></span> <span class="next"><a href="/_blog/http/2_http-status.html">
            常见状态码
          </a></span></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:0;" data-v-70334359></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><div class="kanbanniang" data-v-5775ee02><div class="banniang-container" style="display:;" data-v-5775ee02><div class="messageBox" style="right:68px;bottom:190px;display:none;" data-v-5775ee02>
      欢迎来到 Alphawq's Blog
    </div> <div class="operation" style="right:90px;bottom:40px;display:none;" data-v-5775ee02><i class="kbnfont kbn-ban-home ban-home" data-v-5775ee02></i> <i class="kbnfont kbn-ban-message message" data-v-5775ee02></i> <i class="kbnfont kbn-ban-close close" data-v-5775ee02></i> <a target="_blank" href="https://vuepress-theme-reco.recoluan.com/views/plugins/kanbanniang.html" data-v-5775ee02><i class="kbnfont kbn-ban-info info" data-v-5775ee02></i></a> <i class="kbnfont kbn-ban-theme skin" style="display:;" data-v-5775ee02></i></div> <canvas id="banniang" width="150" height="220" class="live2d" style="right:90px;bottom:-20px;opacity:0.9;" data-v-5775ee02></canvas></div> <div class="showBanNiang" style="display:none;" data-v-5775ee02>
    看板娘
  </div></div></div></div>
    <script src="/_blog/assets/js/app.5d3f5ce3.js" defer></script><script src="/_blog/assets/js/3.59e939e7.js" defer></script><script src="/_blog/assets/js/1.da93e4f7.js" defer></script><script src="/_blog/assets/js/38.91d9c466.js" defer></script><script src="/_blog/assets/js/8.e158b772.js" defer></script>
  </body>
</html>
